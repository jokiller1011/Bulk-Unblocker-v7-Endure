<!DOCTYPE html>
                        <html>
                        <head>
                            <title>Bulk Unblocker - New Tab</title>
                            <style>
                                body { margin: 0; font-family: Arial, sans-serif; background: #1a202c; color: white; }
                                #nav { background: #2d3748; padding: 15px; display: flex; gap: 10px; align-items: center; }
                                #nav input { flex: 1; padding: 12px; border: none; border-radius: 8px; background: #4a5568; color: white; }
                                #nav button { padding: 12px 20px; background: #3182ce; color: white; border: none; border-radius: 8px; cursor: pointer; }
                                #frame { width: 100%; height: calc(100vh - 70px); border: none; background: white; }
                                #loading { display: flex; justify-content: center; align-items: center; height: calc(100vh - 70px); flex-direction: column; background: white; color: #4a5568; }
                                .spinner { width: 50px; height: 50px; border: 5px solid #e2e8f0; border-top: 5px solid #3182ce; border-radius: 50%; animation: spin 1s linear infinite; }
                                @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
                            </style>
                        </head>
                        <body>
                            <div id="nav">
                                <input type="text" id="tab-url" value="${url}" placeholder="Enter website URL">
                                <button onclick="loadUrl()">Go</button>
                            </div>
                            <div id="loading">
                                <div class="spinner"></div>
                                <div>Loading through proxy...</div>
                            </div>
                            <iframe id="frame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups" style="display:none;"></iframe>
                            <script>
                                const proxyServers = ${JSON.stringify(proxyServers)};
                                let currentProxy = 0;
                                
                                function loadUrl() {
                                    let url = document.getElementById('tab-url').value.trim();
                                    if (!url) return;
                                    if (!url.startsWith('http')) url = 'https://' + url;
                                    document.getElementById('tab-url').value = url;
                                    
                                    document.getElementById('loading').style.display = 'flex';
                                    document.getElementById('frame').style.display = 'none';
                                    
                                    tryLoadUrl(url, 0);
                                }
                                
                                async function tryLoadUrl(url, attempt) {
                                    if (attempt >= proxyServers.length) {
                                        document.getElementById('loading').innerHTML = 'All proxies failed. Try a different site.';
                                        return;
                                    }
                                    
                                    try {
                                        const proxyUrl = proxyServers[currentProxy] + encodeURIComponent(url);
                                        const response = await fetch(proxyUrl);
                                        
                                        if (!response.ok) throw new Error('HTTP error');
                                        
                                        let html;
                                        if (proxyServers[currentProxy].includes('allorigins.win')) {
                                            const data = await response.json();
                                            html = data.contents;
                                        } else {
                                            html = await response.text();
                                        }
                                        
                                        const blob = new Blob([html], { type: 'text/html' });
                                        const blobUrl = URL.createObjectURL(blob);
                                        document.getElementById('frame').src = blobUrl;
                                        
                                        document.getElementById('frame').onload = function() {
                                            document.getElementById('loading').style.display = 'none';
                                            document.getElementById('frame').style.display = 'block';
                                        };
                                        
                                    } catch (error) {
                                        currentProxy = (currentProxy + 1) % proxyServers.length;
                                        setTimeout(() => tryLoadUrl(url, attempt + 1), 500);
                                    }
                                }
                                
                                loadUrl();
                                document.getElementById('tab-url').addEventListener('keypress', function(e) {
                                    if (e.key === 'Enter') loadUrl();
                                });
                            <\/script>
                        </body>
                        </html>
                    `;
                    
                    newTab.document.write(tabHtml);
                    newTab.document.close();
                } else {
                    alert('Please allow popups to open new tabs');
                }
            });

            // Event listeners for main window
            submitBtn.addEventListener('click', function() {
                let url = urlInput.value.trim();
                if (!url) return;
                
                if (!url.startsWith('http://') && !url.startsWith('https://')) {
                    url = 'https://' + url;
                }
                
                loadUrl(url);
            });

            urlInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    submitBtn.click();
                }
            });

            homeLink.addEventListener('click', function(e) {
                e.preventDefault();
                contentFrame.src = 'about:blank';
                urlInput.value = '';
                loading.style.display = 'flex';
                contentFrame.style.display = 'none';
                loading.innerHTML = '<div class="spinner"></div><div>Enter a URL to begin</div>';
                urlDisplay.textContent = 'Current: Ready to browse';
                updateStatus('ready', 'Ready to browse');
            });
        });
    </script>
</body>
</html>
